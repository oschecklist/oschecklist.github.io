<html>
<head>
    <title>OS Checklist - A dynamic checklist to help set up computers</title>

    <link rel="stylesheet" href="css/pure-min-0.6.0.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/style.css">

    <script>
        if (!String.prototype.format) {
            String.prototype.format = function() {
                var args = arguments;
                return this.replace(/{(\d+)}/g, function(match, number) {
                    return typeof args[number] != 'undefined' ? args[number] : match ;
                });
            };
        }

        var version = 0; // later will be used in conjunction with load() to update invalid save data
        var Tasks = [
            ["", "Install the browser you will be using for this list. Or open this on another computer (and wipe the saved data, if present).<br />(<a href='https://www.mozilla.org/en-US/firefox/new/?scene=2#download-fx'>Firefox</a>, <a href='https://www.google.com/chrome/'>Chrome</a>, <a href='http://www.opera.com/'>Opera</a>, <a href='https://www.waterfoxproject.org/'>Waterfox</a>, <a href='https://www.torproject.org/projects/torbrowser.html.en'>Tor Browser</a> (warning: you'll end up on a watchlist and may not be able to download all the programs you want to))"],
            ["", "Set up username and password."],
            ["", "Windows 7?", [
                ["", "Get <a href='https://www.microsoft.com/en-us/windows/windows-10-upgrade'>Windows 10</a>?<br />While generally a smoother and more up-to-date OS, 10 suffers from a glitchy settings system, broken updating, and a system that likes pop-ups, distractions, and other annoying stuff&trade;."]
            ]],
            ["", "Windows 10", [
                ["", "Skip connecting to WiFi (or do it)."],
                //NOTE FIX THIS LINK!
                ["", "<b>CUSTOMIZE</b> settings. Do not accept recommended settings (very privacy invasive).<br />Alternately, use <a href=''>this anti-spyware tool</a> later."],
                ["", "Remove tiles from Start Menu (or at least the ones you don't want)."],
                ["", "Uninstall tiles (apps) from Star Menu->All Apps that you don't want."],
                ["", "Link Microsoft account?"]
            ]],
            //NOTE this section kinda unnecessary
            ["", "Is it an HP?", [
                ["", "Uninstall HP crapware."],
                ["", "Uninstall anything you don't want (except Microsoft, Intel, RealTek items)."],
                ["", "Uninstall Norton/McAfee malware..unless you want that kind of thing.<br />(If removing McAfee, don't forget <a href='http://us.mcafee.com/apps/supporttools/mcpr/mcpr.asp'>this tool</a> to completely remove everything (<a href='https://service.mcafee.com/webcenter/portal/cp/home/articleview?articleId=TS101331'>source</a>).)"]
            ]],
            ["", "Uninstall bloatware."],
            ["", "Install anti-malware?", [
                ["", "<a href='http://free.antivirus.com/us/#cleanup-and-prevention'>Trend Micro's software</a> (several useful tools located here).<br />(At time of writing, I recommend Anti-Ransomware, &amp; HouseCall, &amp; <a href='http://sourceforge.net/projects/hjt/'>HiJack This</a>.)"],
                ["", "Not on Windows 10?", [
                    //TODO linkify this list of antivirus and add more!
                    ["", "Install antivirus! (Specially, check out Microsoft's own <a href='http://windows.microsoft.com/en-us/windows/security-essentials-download'>Security Essentials</a>, or your own favorite brand: AVG, Malwarebytes, Avast)"]
                ]]
            ]],
            ["", "Install programs?", [
                ["", "Dropbox?", [
                    ["", "Okay, now go remove it from autoplay."],
                    ["", "Plug in a USB / Take a screenshot with print screen. (So you can cancel its popups and get rid of them.)"]
                    //NOTE may need to also use CD, SD, etc to get rid of all that crap
                ]],
                ["", "Password manager/database?", [
                    ["", "<a href='http://keepass.info/download.html'>KeePass</a>?"]
                    //TODO add LastPass here
                ]],
                ["", "<a href='https://www.piriform.com/ccleaner/download'>CCleaner</a><br />(Crap cleaner: Cleans registry, cookies, various deitrus that builds up when using Windows.)"],
                ["", "Gaming software?", [
                    ["", "Install <a href='http://store.steampowered.com/about/'>Steam</a>!"],
                    ["", "Install <a href='https://www.origin.com/en-us/download'>Origin</a>?"]
                ]]
            ]],
            ["", "Turn autoplay off (unless you want that).<br />(On Windows 10: Settings->Devices->AutoPlay)"]
        ];
        //TODO add a thing that goes if "" -> "default.png"

        var Save = {
            version: 0,
            current: [0],
            skipped: [],
            ignored: []
        };

        function load() {
            var loaded = localStorage.getItem("oschecklist");

            if (loaded != null) {
                Save = JSON.parse(loaded);
                console.log("Task data loaded:");
                console.log(Save);
            } else {
                console.log("Task data not loaded (doesn't exist or invalid).");
            }
        }

        function save() {
            var saveable = JSON.stringify(Save);
            localStorage.setItem("oschecklist", saveable);

            console.log("Saved task data.")
        }

        function getTask() {
            var task = Tasks[Save.current[0]]; //no preceding 2
            if (task === undefined) {
                return ["icon.png", "All tasks complete!"];
            }
            for (var i = 1; i < Save.current.length; i++) {
                task = task[2][Save.current[i]];
            }

            console.log("Got task:");
            console.log(task);

            return task;
        }

        function getNextTask() {
            Save.current[Save.current.length - 1]++;
            var task = Tasks[Save.current[0]]; //no preceding 2
            if (task === undefined) {
                return ["icon.png", "All tasks complete!"];
            }
            for (var i = 1; i < Save.current.length; i++) {
                if (task[2][Save.current[i]] !== undefined) {
                    task = task[2][Save.current[i]];
                } else {
                    Save.current.pop();
                    return getNextTask();
                }
            }

            console.log("Got (next) task:");
            console.log(task);

            return task;
        }

        function display(task) {
            if ((task.length == 2) && ! (task[1] == "All tasks complete!")) {
                document.getElementById("current").innerHTML = "<td style='width:10%;'><button class='pure-button button-complete' onclick='javascript:completeTask();' title='Task complete.'><span class='fa fa-check'></span></button></td><td class='task'><img src='{0}'><p>{1}</p></td><td style='width:10%;'><button class='pure-button button-later' onclick='javascript:skipTask();' title='Do this later.'><span class='fa fa-clock-o'></span></button></td><td style='width:10%;'><button class='pure-button button-ignore' onclick='javascript:ignoreTask();' title='I\'m not doing this.'><span class='fa fa-times'></span></button></td>".format(task[0], task[1]);
            } else {
                document.getElementById("current").innerHTML = "<td style='width:10%;'><button class='pure-button button-complete' onclick='javascript:completeTask();' title='I\'m doing this.'><span class='fa fa-check'></span></button></td><td colspan='2' class='task'><img src='{0}'><p>{1}</p></td><td style='width:10%;'><button class='pure-button button-ignore' onclick='javascript:ignoreTask();' title='I\'m not doing this.'><span class='fa fa-times'></span></button></td>".format(task[0], task[1]);
            }

            console.log("Displayed task:");
            console.log(task);
        }

        function completeTask() {
            console.log("Completing task:");
            console.log(getTask());

            if (getTask()[2] !== undefined) {
                // if question -> do question
                Save.current.push(0);
                display(getTask());
            } else {
                // else -> next
                display(getNextTask());
            }
        }

        function ignoreTask() {
            console.log("Ignoring task:");
            console.log(getTask());

            // we only save ignored questions
            // (so updates to the question doesn't give us new tasks we don't want)
            if (getTask()[2] !== undefined) {
                Save.ignored.push(Save.current);
            }
            display(getNextTask());
        }

        var nextID = 0; // used in skipTask() and lateTask()

        function skipTask() {
            var id = "id" + nextID++;
            Save.skipped.push([id, Save.current]);
            console.log("Skipping task:");
            var task = getTask();
            console.log(task);
            var skipped = document.createElement("tr");
            skipped.setAttribute("id", "id" + id);
            skipped.innerHTML = "<td style='width:10%;'><button class='pure-button button-complete' onclick='javascript:lateTask({0});' title='Task complete.'><span class='fa fa-check'></span></button></td><td colspan='2' class='task'><img src='{1}'><p>{2}</p></td><td style='width:10%;'><button class='pure-button button-ignore' onclick='javascript:lateTask({0});' title='I\'m not doing this.'><span class='fa fa-times'></span></button></td>".format("id" + id, task[0], task[1]);
            document.getElementById("skipped").appendChild(skipped);
            display(getNextTask());
        }

        function lateTask(id) {
            console.log("Removing late task...");

            // take off of our list
            for (var i = 0; i < Save.skipped.length; i++) {
                if (Save.skipped[i][0] == id) {
                    Save.skipped.splice(i, 1);
                    break;
                }
            }
            // remove element with specified ID
            var element = document.getElementById(id);
            element.parentNode.removeChild(element);

            console.log("Task data:");
            console.log(Save);
        }

        window.onload = function() {
            setTimeout(function() { display(getTask()); }, 1);

            /*
            if (window.addEventListener) {
                window.addEventListener("storage", handleStorage, false);
            } else {
                window.attachEvent("onstorage", handleStorage);
            }
            */
        };
    </script>
</head>
<body>
    <table class="pure-table pure-table-horizontal centered">
        <tbody>
            <tr>
                <th colspan="4">Current Task:</th>
            </tr>

            <tr id="current"></tr>

            <tr>
                <th colspan="4">Skipped Tasks:</th>
            </tr>
        </tbody>

        <tfoot id="skipped"></tfoot>
    </table>
</body>
</html>
